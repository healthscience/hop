<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOP System Architecture Documentation</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        .container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 20px;
        }
        .architecture-diagram {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .code-summary {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 15px 0;
        }
        .relationship-map {
            background: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        .relationship-map pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .component-details {
            margin-bottom: 20px;
        }
        .component-details h3 {
            color: #e74c3c;
        }
        .method-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        .method-list li {
            margin: 5px 0;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 4px;
        }
    </style>
</head>
<body>
      <div class="relationship-map">
  <h2>Detailed Component Relationships</h2>
  
  <h3>Message Flow Sequence</h3>
  <pre>
Message Flow Sequence
+------------------------+
|     WebSocket Server   |
+------------------------+
|
v
+------------------------+
|   MessageFlow Layer    |
|                        |
|  +------------------+  |
|  | Event Emission   |  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | Message Routing  |  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | Error Handling   |  |
|  +------------------+  |
+------------------------+
|
v
+------------------------+
|    Component Layer     |
|                        |
|  +------------------+  |
|  | SafeFlow         |  |
|  | - Compute Tasks  |  |
|  | - Model Loading  |  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | Library          |  |
|  | - Data Storage   |  |
|  | - System Contracts|  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | BB (BeeBee)      |  |
|  | - AI Operations  |  |
|  | - Library Data   |  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | DML              |  |
|  | - Distributed ML |  |
|  | - Peer Learning  |  |
|  +------------------+  |
+------------------------+
  </pre>

  <h3>Authentication Flow</h3>
  <pre>
Authentication Flow
+------------------------+
|    Client Request      |
|  (hop-auth message)    |
+------------------------+
|
v
+------------------------+
|     HOP System        |
|  (hopConnect method)  |
+------------------------+
|
v
+------------------------+
|   SafeFlow Route      |
|  (authHOP method)     |
+------------------------+
|
v
+------------------------+
|  SafeFlow ECS         |
|  (networkAuthorization)|
+------------------------+
|
v
+------------------------+
|    Response Flow      |
|                       |
|  1. Token Generation  |
|  2. Auth Status       |
|  3. WebSocket Send    |
+------------------------+
  </pre>

  <h3>Data Flow Through Components</h3>
  <pre>
Data Flow Through Components
+------------------------+
|     Library Data       |
|                        |
|  +------------------+  |
|  | Data Storage     |  |
|  +------------------+  |
|                        |
|  +------------------+  |
|  | System Contracts |  |
|  +------------------+  |
+------------------------+
|
v
+------------------------+
|    BB (BeeBee)        |
|  (bbAIpath method)    |
+------------------------+
|
v
+------------------------+
|    SafeFlow Route     |
|  (newSafeflow method) |
+------------------------+
|
v
+------------------------+
|    SafeFlow ECS       |
|  (startFlow method)   |
+------------------------+
|
v
+------------------------+
|    Compute Engine     |
|  (Model Execution)    |
+------------------------+
  </pre>

  <h3>Real-time Communication Flow</h3>
  <pre>
Real-time Communication Flow
+------------------------+
|    WebSocket Message   |
|  (ws.on('message'))    |
+------------------------+
|
v
+------------------------+
|   Message Authenticator|
|  (messageAuth method)  |
+------------------------+
|
v
+------------------------+
|    Event Router       |
|  (messageResponder)   |
+------------------------+
|
v
+------------------------+
|    Component Handlers  |
|  (Library, BB, DML)    |
+------------------------+
|
v
+------------------------+
|    Response Handler    |
|  (ws.send)            |
+------------------------+
  </pre>
</div>

<div class="component-details">
  <h2>Component-Specific Flows</h2>

  <div class="component-details">
      <h3>SafeFlow Route Flow</h3>
      <ul class="method-list">
          <li>
              <strong>routeMessage()</strong>
              <ul>
                  <li>Authenticates messages</li>
                  <li>Routes to appropriate handlers</li>
                  <li>Manages error handling</li>
              </ul>
          </li>
          <li>
              <strong>authHOP()</strong>
              <ul>
                  <li>Generates authentication tokens</li>
                  <li>Manages network authorization</li>
                  <li>Handles secure connections</li>
              </ul>
          </li>
          <li>
              <strong>newSafeflow()</strong>
              <ul>
                  <li>Starts compute operations</li>
                  <li>Manages model loading</li>
                  <li>Handles compute results</li>
              </ul>
          </li>
      </ul>
  </div>

  <div class="component-details">
      <h3>Library System Flow</h3>
      <ul class="method-list">
          <li>
              <strong>libManager.systemsContracts()</strong>
              <ul>
                  <li>Manages system contracts</li>
                  <li>Handles data storage</li>
                  <li>Provides data access</li>
              </ul>
          </li>
          <li>
              <strong>library-data handler</strong>
              <ul>
                  <li>Processes data requests</li>
                  <li>Manages data updates</li>
                  <li>Handles data queries</li>
              </ul>
          </li>
      </ul>
  </div>

  <div class="component-details">
      <h3>BB (BeeBee) System Flow</h3>
      <ul class="method-list">
          <li>
              <strong>bbAIpath()</strong>
              <ul>
                  <li>Processes AI requests</li>
                  <li>Handles library data</li>
                  <li>Manages compute queries</li>
              </ul>
          </li>
          <li>
              <strong>AI Operations</strong>
              <ul>
                  <li>Performs AI computations</li>
                  <li>Handles model updates</li>
                  <li>Manages AI results</li>
              </ul>
          </li>
      </ul>
  </div>
</div>
</div>
</body>
</html>